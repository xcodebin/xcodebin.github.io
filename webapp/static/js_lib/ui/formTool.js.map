{"version":3,"sources":["ui/formTool.coffee"],"names":[],"mappings":"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","file":"formTool.js","sourcesContent":["# About: 表单插件\r\n# Other:\r\n# Created: Xiaolong WU on 16/8/18 上午12:30.\r\n# Editored:\r\n# VersionHistory:\r\n#   V16.08.18  初始化构造\r\n#   jquery  ^2.2.2\r\n#   semantic ^2.1.8\r\n#   underscore  ^1.8.3\r\n# TODO:\r\n\r\n###\r\nApi:\r\n  $.fromTool() 初始化table return 当前datagrid 与节点绑定的对象1对1对象\r\n  $.fn.fromTool.opts 全局参数设置\r\n  事件触发优先高->低:\r\n\r\n  attr 属性 可以console.log打印下即可知道对象属性和方法\r\n    $ele 表单对象jq节点对象\r\n    dataAll 表单元素节点对象\r\n      dataAll格式:\r\n        {\r\n          name:{\r\n            $ele:$ele   //表单JQ节点对象\r\n            name:name   //表单name值\r\n            value:value //表单数据\r\n            state:state //状态 1启用 2禁用 3隐藏\r\n            vali:vali //验证状态 1未验证 2验证通过 3验证不通过\r\n          }\r\n          ...\r\n        }\r\n\r\n\r\n\r\n\r\n  opt 配置\r\nOK    url(str): 表单提交地址\r\nOK    params(data): 表单固定提交参数\r\n      data格式:\r\n        {\r\n          key:value   //key是提交的key值  value为提交的实际值 可以是obj\r\n          key2:value\r\n        }\r\nOK    commitFilter(fn(opts(dataArr))): 提交数据过滤方法,返回false停止提交,返回json,追加到提交内容中\r\n      dataArr格式:\r\n        [{\r\n          $ele:$ele   //表单JQ节点对象\r\n          name:name   //表单name值\r\n          value:value //表单数据\r\n        }]\r\nOK    validateFiles(array[obj]): 表单验证规则,不定义则没验证\r\n      格式:\r\n        [{\r\n          identifier:'dropTree',//验证name 需与表单的name相同\r\n          rules: [\r\n            {type: 'empty', prompt: '必填'} //验证规则  具体可见 semantic Api http://www.semantic-ui.cn/behaviors/form.html\r\n          ]\r\n        }]\r\nNO    disableInputs(array[str]):屏蔽表单填写,根据表单name名称\r\nOK    defaultValues(array[data]):设置表单默认值,不包含下拉框\r\n      data格式:\r\n        [{\r\n          name:'123',       //表单name\r\n          value:'5555'      //表单值\r\n        }]\r\n    onValidate(fn(opts(data,dataAll))): 表单验证前回调 data为提交的全部数据 dataAll 表单元素节点对象\r\n      data格式:\r\n        {\r\n          key1:val1,\r\n          key2:val2,\r\n          key3:val3\r\n          ...\r\n        }\r\n      dataAll格式:\r\n        {\r\n          name:{\r\n            $ele:$ele   //表单JQ节点对象\r\n            name:name   //表单name值\r\n            value:value //表单数据\r\n            state:state //状态 1启用 2禁用 3隐藏\r\n            vali:vali //验证状态 1未验证 2验证通过 3验证不通过\r\n          }\r\n          ...\r\n        }\r\nOK    onInitForm(fn(opts(dataAll))):初始化表单结束\r\n    onValSuccess(fn(opts(data,dataAll))): 表单验证成功 data为提交的全部数据 dataAll 表单元素节点对象 格式见onValidate\r\n    onValFail(fn(opts(data,dataAll,dataFailAll))): 表单验证失败 data为提交的全部数据  dataAll 表单元素节点对象 dataFailAll 为错误数据对象 格式见onValidate\r\n    onCommit(fn(opts(data,dataAll))):表单提交后回调事件 data为提交的全部数据  dataAll 表单元素节点对象 格式见onValidate\r\n    onComSuccess(fn(opts(comData,dataAll,resData))):表单提交返回成功后回调事件 comData 提交数据对象, dataAll 表单元素节点对象 ,resData 返回数据 格式见onValidate\r\n    onComFail(fn(opts(comData,dataAll,resData))):表单提交返回失败后回调事件 comData 提交数据对象, dataAll 表单元素节点对象, resData 返回数据 格式见onValidate\r\n    onComError(fn(opts(comData,dataAll,resData))):表单提交异常后回调事件 comData 提交数据对象, dataAll 表单元素节点对象,resData 返回数据 格式见onValidate\r\n    onComFinally(fn(opts(comdata,dataAll))):表单提交后任何响应完成后都会回调的事件 comdata 提交数据对象, dataAll 表单元素节点对象 格式见onValidate\r\n    onClearForm(fn(opts(data,dataAll))):表单清空时回调事件 data 提交数据对象,dataAll 表单元素节点对象 格式见onValidate\r\n\r\n\r\n  fn  eg: obj.getRow({index:1}) 或 $**.fromTool(\"getRow\",{index:1})\r\n    setUrl(url): 设置表单提交地址\r\n    setParams(data):设置表单固定提交参数\r\n    setCommitFileter(fn(dataArr)):设置提交数据过滤方法,返回false停止提交,返回json,追加到提交内容中,dataArr为提交数据\r\n    setValidateFiles(dataArr):设置表单验证规则\r\n      dataArr格式:\r\n        [{\r\n          identifier:'dropTree',//验证name 需与表单的name相同\r\n          rules: [\r\n            {type: 'empty', prompt: '必填'} //验证规则  具体可见 semantic Api http://www.semantic-ui.cn/behaviors/form.html\r\n          ]\r\n        }]\r\n    setDisable(ele,name):设置屏蔽表单项目,ele(jquery对象)和name(名称)选填,都不填,则整个表单都屏蔽不可编辑\r\n    setEnable(ele,name):设置启用表单项目,ele(jquery对象)和name(名称)选填,都不填,则整个表单都屏蔽不可编辑\r\n    setDefValue(dataArr):设置表单默认值\r\n      dataArr格式:\r\n        [{\r\n          $ele:$ele   //表单JQ节点对象   $ele和 name可以二选一填写\r\n          name:name   //表单name值\r\n          value:value //表单数据\r\n        }]\r\n    validateForm():验证表单合法性\r\n    commitForm(data):提交表单信息,data是追加上的参数,非必须\r\n    getFormEle():获取表单jq对象\r\n    getFormNodeEle(name):获取表单元素对象 name不传则返回全部表单对象数组\r\n    setNodeData(obj(name,value)/objArr[obj[name,value]]):设置表单元素值\r\n    getFormData():获取表单填写数据集合\r\n      返回类型格式:\r\n        [{\r\n          $ele:$ele   //表单JQ节点对象\r\n          name:name   //表单name值\r\n          value:value //表单数据\r\n        }]\r\n    getCommitData():获取全部提交数据\r\n        返回类型格式:\r\n        [{\r\n          $ele:$ele   //表单JQ节点对象  可能为空\r\n          name:name   //表单name值\r\n          value:value //表单数据\r\n        }]\r\n    setHideData(data):设置隐藏值  隐藏值会连同commit 一并提交到后端\r\n    getHideData():获取隐藏值\r\n    clearHideData():清空隐藏值  节点添加 noClear='true'属性的节点将不会被清除\r\n    clearForm():清空表单信息\r\n\r\n  event 事件\r\n    onValidate(fn(opts(data,dataAll))): 表单验证前回调 data为提交的全部数据 dataAll 表单元素节点对象\r\n    onValSuccess(fn(opts(data,dataAll))): 表单验证成功 data为提交的全部数据 dataAll 表单元素节点对象 格式见onValidate\r\n    onValFail(fn(opts(data,dataAll,dataFailAll))): 表单验证失败 data为提交的全部数据  dataAll 表单元素节点对象 dataFailAll 为错误数据对象 格式见onValidate\r\n    onCommit(fn(opts(data,dataAll))):表单提交回调事件 data为提交的全部数据  dataAll 表单元素节点对象 格式见onValidate\r\n    onComSuccess(fn(opts(comData,dataAll,resData))):表单提交返回成功后回调事件 comData 提交数据对象, dataAll 表单元素节点对象 ,resData 返回数据 格式见onValidate\r\n    onComFail(fn(opts(comData,dataAll,resData))):表单提交返回失败后回调事件 comData 提交数据对象, dataAll 表单元素节点对象, resData 返回数据 格式见onValidate\r\n    onComError(fn(opts(comData,dataAll,resData))):表单提交异常后回调事件 comData 提交数据对象, dataAll 表单元素节点对象,resData 返回数据 格式见onValidate\r\n    onComFinally(fn(opts(comdata,dataAll))):表单提交后任何响应完成后都会回调的事件 comdata 提交数据对象, dataAll 表单元素节点对象 格式见onValidate\r\n    onClearForm(fn(opts(data,dataAll))):表单清空时回调时间 data 提交数据对象,dataAll 表单元素节点对象 格式见onValidate\r\n\r\n\r\n###\r\n\r\n\r\nclass fromTool\r\n\r\n  constructor:(@$ele,opts,others...)->\r\n    @defaults= # 默认参数\r\n      hidaData:null # 隐藏数据对象\r\n\r\n    @opt = $.extend({}, @defaults,$.fn.fromTool.opts, opts)\r\n\r\n    @initForm()\r\n\r\n\r\n\r\n  ###\r\n    执行路由\r\n    opts\r\n  ###\r\n  perform:(opts,others...)->\r\n    if _.isObject opts # 进行参数覆盖\r\n      @opt = $.extend({}, @opt,opts)\r\n    else\r\n      if _.isString opts # 执行方法调用\r\n        fun = eval(\"this.#{opts}\")\r\n        fun(others[0])\r\n\r\n\r\n  ###\r\n    初始化表单结构\r\n    opts\r\n  ###\r\n  initForm:->\r\n    $inputNodes = @$ele.find(\"[name]\")\r\n    #构建表单数据\r\n    @dataAll = new Object()\r\n    for $input in $inputNodes\r\n      name = $input.attr \"name\"  # 获取name值\r\n      value = $input.val()  # 获取表单控件值\r\n      data =\r\n        $ele:$input\r\n        name:name\r\n        value:value\r\n      @dataAll[name]=data\r\n\r\n    # 验证器编写\r\n    valiFiles = @opt.validateFiles\r\n    if valiFiles\r\n      fields = new Object()\r\n      for valifile in valiFiles\r\n        valiName = valifile.identifier\r\n        fields[valiName] = valifile\r\n\r\n      @$ele.form(\r\n        fields:fields\r\n        inline : true\r\n        on:'blur'\r\n      )\r\n\r\n    # 设置默认值\r\n    defaultValues = @opt.defaultValues\r\n    if defaultValues\r\n      for defVal in defaultValues\r\n        name = defVal.name\r\n        value = defVal.value\r\n        data = @dataAll[name]\r\n        data.value = value\r\n        data.$ele.val(value)\r\n        @dataAll[name] = data\r\n\r\n    @opt.onInitForm?(dataAll:@dataAll)\r\n\r\n\r\n  ###\r\n    提交应用程序\r\n    opts\r\n  ###\r\n  commit:(opts)->\r\n    formParams = @$ele.serializeArray()\r\n    query = $.extend(formParams,@opt.params)\r\n    @loaderQuery = @opt.commitFilter?(query:query)\r\n\r\n\r\n    jsonTool = $.jsonTool('ajax',{\r\n      url:@opt.url\r\n      data:$.extend(query,@loaderQuery)\r\n      onSuccess:(data)=>\r\n      onError:(err)=>\r\n    })\r\n\r\n\r\n\r\n\r\n\r\n  ###\r\n    表单验证前回调 data为提交的全部数据 dataAll 表单元素节点对象\r\n    opts\r\n  ###\r\n  onValidate:(opts)->\r\n    @opt.onValidate = opts\r\n\r\n\r\n\r\n  ###\r\n    表单验证成功 data为提交的全部数据 dataAll 表单元素节点对象 格式见onValidate\r\n    opts\r\n  ###\r\n  onValSuccess:(opts)->\r\n    @opt.onValSuccess = opts\r\n\r\n\r\n\r\n  ###\r\n    表单验证失败 data为提交的全部数据  dataAll 表单元素节点对象 dataFailAll 为错误数据对象 格式见onValidate\r\n    opts\r\n  ###\r\n  onValFail:(opts)->\r\n    @opt.onValFail = opts\r\n\r\n\r\n  ###\r\n    表单提交回调事件 data为提交的全部数据  dataAll 表单元素节点对象 格式见onValidate\r\n    opts\r\n  ###\r\n  onCommit:(opts)->\r\n    @opt.onCommit = opts\r\n\r\n\r\n  ###\r\n    表单提交返回成功后回调事件 comData 提交数据对象, dataAll 表单元素节点对象 ,resData 返回数据 格式见onValidate\r\n    opts\r\n  ###\r\n  onComSuccess:(opts)->\r\n    @opt.onComSuccess = opts\r\n\r\n\r\n  ###\r\n    表单提交返回失败后回调事件 comData 提交数据对象, dataAll 表单元素节点对象, resData 返回数据 格式见onValidate\r\n    opts\r\n  ###\r\n  onComFail:(opts)->\r\n    @opt.onComFail = opts\r\n\r\n\r\n  ###\r\n    表单提交异常后回调事件 comData 提交数据对象, dataAll 表单元素节点对象,resData 返回数据 格式见onValidate\r\n    opts\r\n  ###\r\n  onComError:(opts)->\r\n    @opt.onComError = opts\r\n\r\n\r\n  ###\r\n    表单提交后任何响应完成后都会回调的事件 comdata 提交数据对象, dataAll 表单元素节点对象 格式见onValidate\r\n    opts\r\n  ###\r\n  onComFinally:(opts)->\r\n    @opt.onComFinally = opts\r\n\r\n\r\n  ###\r\n    表单清空时回调时间 data 提交数据对象,dataAll 表单元素节点对象 格式见onValidate\r\n    opts\r\n  ###\r\n  onClearForm:(opts)->\r\n    @opt.onClearForm = opts\r\n\r\n\r\n\r\n\r\n\r\n\r\n(->\r\n  $.fn.fromTool = (opts,others...)->\r\n    obj = this.data(\"obj\")\r\n    if obj\r\n      obj.perform(opts,others...)\r\n    else\r\n      obj = new fromTool(this,opts,others...)\r\n      this.data(\"obj\",obj)\r\n    return obj\r\n\r\n  # 表格全局参数\r\n  $.fn.fromTool.opts ={}\r\n)()"]}